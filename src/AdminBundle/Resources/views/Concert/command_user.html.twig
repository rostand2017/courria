{% extends "AdminBundle::layout.html.twig" %}
{% block title %} Commande(s) {% endblock %}
{% block titleContent %} Commandes de {{ user.name }} {% endblock %}
{% block body %}
    <ul class="breadcrumb" style="background: none;">
        <li class="breadcrumb-item"><a href="{{ path('admin_command') }}">Toutes les commandes</a></li>
        <li class="breadcrumb-item active">commande de {{ user.name }}</li>
    </ul>
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-white">
                <div class="panel-heading">
                    <h5 class="panel-title">Commande(s)</h5>
                    <div class="panel-control">
                        <a href="javascript:void(0);" data-toggle="tooltip" class="panel-collapse" data-original-title="Reduire/Agrandir">
                            <i class="icon-arrow-down fa-2x"></i>
                        </a>
                        <a href="" data-toggle="tooltip" class="panel-reload" data-original-title="Rafraichir">
                            <i class="icon-reload fa-2x"></i>
                        </a>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="row m-t-sm">
                        <div class="col-md-12">
                            <div class="table-responsive project-stats">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Produit</th>
                                            <th></th>
                                            <th>Quantité</th>
                                            <th>Date de paiement</th>
                                            <th>#</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for command in commands %}
                                            <tr>
                                                <td><img src="uploads/thumbnails/{{ command.product.images[0].thumbnail }}" alt="{{ command.product.name }}"></td>
                                                <td>{{ command.product.name }}</td>
                                                <td>{{ command.number }}</td>
                                                <td>{{ command.createdAt | date('d-m-y') }}</td>
                                                <td>
                                                    <a href="javascript:void(0);"  data-url="{{ path("admin_command_valid") }}?id_user={{ user.id }}&id_command={{ command.id }}" class="btn btn-primary validOne">valider</a>
                                                </td>
                                            </tr>
                                        {% else %}
                                            <tr class="text-center text-info">
                                                <td colspan="5">Aucune commande(s)</td>
                                            </tr>
                                        {% endfor %}
                                    {% if commands is not empty %}
                                        <tr>
                                            <td colspan="5" class="text-center"><a href="javascript:void(0);" data-url="{{ path('admin_command_valid_all') }}?id_user={{ user.id }}" class="btn btn-danger validAll">Valider toutes les commandes</a></td>
                                        </tr>
                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        $(document).on('click','.validOne', function (e) {
            e.preventDefault();
            var url = $(this).data('url');
            swal({
                    title: "Validation",
                    text: "Validez la livraison de ce vêtement",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#46DDC6",
                    confirmButtonText: "Oui, valider!",
                    cancelButtonText: "Annuler",
                    closeOnConfirm: true
                },
                function(isConfirm){
                    if (isConfirm) {
                        $.ajax({
                            type: 'get',
                            url : url,
                            datatype: 'json',
                            success: function (json) {
                                if (json.status == 0) {
                                    toastr.success(json.mes,'Succès!');
                                    window.location.reload();
                                }else{
                                    toastr.error(json.mes,'Oups!');
                                }
                            },
                            error: function(jqXHR, textStatus, errorThrown){}
                        });
                    }
                });
        });

        $(document).on('click','.validAll', function (e) {
            e.preventDefault();
            var url = $(this).data('url');
            swal({
                    title: "Validez tout",
                    text: "Validez la livraison de ce vêtement",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#46DDC6",
                    confirmButtonText: "Oui, valider!",
                    cancelButtonText: "Annuler",
                    closeOnConfirm: true
                },
                function(isConfirm){
                    if (isConfirm) {
                        $.ajax({
                            type: 'get',
                            url : url,
                            datatype: 'json',
                            success: function (json) {
                                if (json.status == 0) {
                                    toastr.success(json.mes,'Succès!');
                                    window.location.reload();
                                }else{
                                    toastr.error(json.mes,'Oups!');
                                }
                            },
                            error: function(jqXHR, textStatus, errorThrown){}
                        });
                    }
                });
        });
    </script>
{% endblock %}